---
title: "Flyway: ddl-autoì˜ ê³µí¬ì—ì„œ ë²—ì–´ë‚˜ DB ìŠ¤í‚¤ë§ˆë¥¼ í˜•ìƒ ê´€ë¦¬í•˜ê¸°"
date: 2025-12-20
categories: [DevOps, Database]
tags: [Flyway, Database Migration, Spring Boot, JPA, CI/CD, Version Control, TIL]
excerpt: "í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ JPA ddl-auto ì˜µì…˜ì„ ì‚¬ìš©í•˜ëŠ” ìœ„í—˜ì„±ì„ ì¸ì§€í•˜ê³ , Flywayë¥¼ ë„ì…í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ë³€ê²½ ì´ë ¥ì„ ì½”ë“œì²˜ëŸ¼ ë²„ì „ ê´€ë¦¬í•˜ëŠ” ë°©ë²•ì„ í•™ìŠµí•©ë‹ˆë‹¤. íŠ¹íˆ ì´ë¯¸ ìš´ì˜ ì¤‘ì¸ DBì— Flywayë¥¼ ì¤‘ê°„ ë„ì…í•  ë•Œ í•„ìˆ˜ì ì¸ Baseline ì„¤ì • ì „ëµì„ ì•Œì•„ë´…ë‹ˆë‹¤."
author_profile: true
---

# Today I Learned: Flyway: ddl-autoì˜ ê³µí¬ì—ì„œ ë²—ì–´ë‚˜ DB ìŠ¤í‚¤ë§ˆë¥¼ í˜•ìƒ ê´€ë¦¬í•˜ê¸°

## ğŸ“š ì˜¤ëŠ˜ í•™ìŠµí•œ ë‚´ìš©

ë¡œì»¬ ê°œë°œ í™˜ê²½ì—ì„œëŠ” JPAì˜ `ddl-auto: update`ê°€ í¸ë¦¬í•˜ì§€ë§Œ, ìš´ì˜ í™˜ê²½(Production) ë°°í¬ ì‹œì—ëŠ” ì´ ì˜µì…˜ì´ ëŒ€ì¬ì•™ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê°œë°œìê°€ ì˜ë„ì¹˜ ì•Šê²Œ ì»¬ëŸ¼ì„ ë‚ ë¦¬ê±°ë‚˜, ë°ì´í„° íƒ€ì…ì„ ë³€ê²½í•˜ì—¬ ë°ì´í„° ìœ ì‹¤ì´ ë°œìƒí•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

ê·¸ë ‡ë‹¤ê³  ë§¤ë²ˆ DBAë‚˜ ê°œë°œìê°€ ìˆ˜ë™ìœ¼ë¡œ SQL ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ëŠ” ê²ƒì€ **"ëˆ„ê°€ ì–¸ì œ ì‹¤í–‰í–ˆëŠ”ì§€"** ì¶”ì í•˜ê¸° ì–´ë µê³ , íœ´ë¨¼ ì—ëŸ¬ì˜ ìœ„í—˜ì´ í½ë‹ˆë‹¤. ì˜¤ëŠ˜ì€ DB ìŠ¤í‚¤ë§ˆ ë³€ê²½ì„ ì½”ë“œ(Git)ì²˜ëŸ¼ ë²„ì „ ê´€ë¦¬í•˜ê³ , ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ì‹œì ì— ìë™ìœ¼ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜í•´ì£¼ëŠ” ë„êµ¬ì¸ **Flyway**ì˜ ì ìš©ë²•ê³¼ ì „ëµì„ í•™ìŠµí–ˆìŠµë‹ˆë‹¤.

---

### 1. **Flywayì˜ í•µì‹¬ ë™ì‘ ì›ë¦¬ âœˆï¸**

FlywayëŠ” **`flyway_schema_history`**ë¼ëŠ” í…Œì´ë¸”ì„ ìƒì„±í•˜ì—¬ ë§ˆì´ê·¸ë ˆì´ì…˜ ì´ë ¥ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.

1.  ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹œì‘ë  ë•Œ `resources/db/migration` í´ë”ë¥¼ ìŠ¤ìº”í•©ë‹ˆë‹¤.
2.  `V1__init.sql`, `V2__add_column.sql` ê°™ì€ SQL íŒŒì¼ë“¤ì„ ì°¾ìŠµë‹ˆë‹¤.
3.  `flyway_schema_history` í…Œì´ë¸”ì„ ì¡°íšŒí•˜ì—¬, **ì•„ì§ ì‹¤í–‰ë˜ì§€ ì•Šì€ ë²„ì „ì˜ SQL**ë§Œ ìˆœì„œëŒ€ë¡œ ì‹¤í–‰í•©ë‹ˆë‹¤.
4.  ì‹¤í–‰ í›„ ê²°ê³¼ë¥¼ íˆìŠ¤í† ë¦¬ í…Œì´ë¸”ì— ê¸°ë¡í•©ë‹ˆë‹¤ (Checksum í¬í•¨).
5.  ë§Œì•½ ì´ë¯¸ ì‹¤í–‰ëœ íŒŒì¼ì˜ ë‚´ìš©(Checksum)ì´ ë³€ê²½ë˜ì—ˆë‹¤ë©´, ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ì„ ì¤‘ë‹¨ì‹œì¼œ ì •í•©ì„±ì„ ë³´ì¥í•©ë‹ˆë‹¤.

---

### 2. **Spring Bootì— ì ìš©í•˜ê¸°**

#### **Step 1: ì˜ì¡´ì„± ì¶”ê°€**
Spring BootëŠ” Flyway ì˜ì¡´ì„±ë§Œ ì¶”ê°€í•˜ë©´ ìë™ìœ¼ë¡œ ê°ì§€í•˜ê³  êµ¬ì„±í•©ë‹ˆë‹¤.

```groovy
implementation 'org.flywaydb:flyway-core'
// MySQL 8.0 ì´ìƒì„ ì“´ë‹¤ë©´ ì•„ë˜ ì˜ì¡´ì„±ë„ í•„ìš”í•  ìˆ˜ ìˆìŒ (ë²„ì „ì— ë”°ë¼ ìƒì´)
implementation 'org.flywaydb:flyway-mysql'
```

#### **Step 2: `application.yml` ì„¤ì •**
ìš´ì˜ ì¤‘ì¸ ì„œë¹„ìŠ¤ì— ë„ì…í•  ë•Œ ê°€ì¥ ì¤‘ìš”í•œ ì˜µì…˜ì€ `baseline-on-migrate`ì…ë‹ˆë‹¤.

```yaml
spring:
  jpa:
    # Flywayë¥¼ ì“´ë‹¤ë©´ JPAì˜ DDL ìƒì„± ê¸°ëŠ¥ì€ êº¼ì•¼ í•¨ (ì¶©ëŒ ë°©ì§€)
    hibernate:
      ddl-auto: validate 
  flyway:
    enabled: true
    # ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ ìœ„ì¹˜ (ê¸°ë³¸ê°’)
    locations: classpath:db/migration
    # (ì¤‘ìš”) ì´ë¯¸ í…Œì´ë¸”ì´ ì¡´ì¬í•˜ëŠ” DBì— ì²˜ìŒ Flywayë¥¼ ì ìš©í•  ë•Œ trueë¡œ ì„¤ì •
    baseline-on-migrate: true
    # ê¸°ì¤€ ë²„ì „ (ì´ ë²„ì „ ì´í•˜ì˜ ìŠ¤í¬ë¦½íŠ¸ëŠ” ë¬´ì‹œí•˜ê³ , ì´ë¯¸ ì ìš©ëœ ê²ƒìœ¼ë¡œ ê°„ì£¼)
    baseline-version: 1
```

---

### 3. **ì´ë¯¸ ìš´ì˜ ì¤‘ì¸ DBì— ì ìš©í•˜ê¸° (Baseline ì „ëµ)**

ì‹ ê·œ í”„ë¡œì íŠ¸ë¼ë©´ `V1__init.sql`ë¶€í„° ì‹œì‘í•˜ë©´ ë˜ì§€ë§Œ, ì´ë¯¸ í…Œì´ë¸”ì´ ì”ëœ© ìˆëŠ” ìš´ì˜ DBì— Flywayë¥¼ ë„ì…í•  ë•ŒëŠ” ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.

**ì‹œë‚˜ë¦¬ì˜¤**: í˜„ì¬ ìš´ì˜ DBì—ëŠ” `users`, `orders` í…Œì´ë¸”ì´ ì´ë¯¸ ì¡´ì¬í•¨.

1.  **í˜„ì¬ ìŠ¤í‚¤ë§ˆ ì¶”ì¶œ**: ìš´ì˜ DBì˜ í˜„ì¬ ìƒíƒœ(`CREATE TABLE ...`)ë¥¼ ë¤í”„ ë– ì„œ `V1__init_schema.sql`ë¡œ ë§Œë“­ë‹ˆë‹¤.
2.  **Baseline ì„¤ì •**: `application.yml`ì— `baseline-on-migrate: true`ì™€ `baseline-version: 1`ì„ ì„¤ì •í•©ë‹ˆë‹¤.
3.  **ë°°í¬ ë° ì‹¤í–‰**:
    -   FlywayëŠ” DBê°€ ë¹„ì–´ìˆì§€ ì•ŠìŒì„ ê°ì§€í•©ë‹ˆë‹¤.
    -   `baseline-on-migrate`ê°€ ì¼œì ¸ ìˆìœ¼ë¯€ë¡œ, `flyway_schema_history` í…Œì´ë¸”ì„ ë§Œë“¤ê³  **"V1 ë²„ì „ì€ ì´ë¯¸ ì‹¤í–‰ëœ ê²ƒìœ¼ë¡œ ì¹˜ì(Baseline)"**ë¼ê³  ê¸°ë¡ë§Œ ë‚¨ê¹ë‹ˆë‹¤. (ì‹¤ì œ `V1` SQLì€ ì‹¤í–‰í•˜ì§€ ì•ŠìŒ)
4.  **ì´í›„ ë³€ê²½**: ì•ìœ¼ë¡œì˜ ë³€ê²½ ì‚¬í•­ì€ `V2__add_email_to_users.sql` ë“±ìœ¼ë¡œ ë§Œë“¤ë©´ ì •ìƒì ìœ¼ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ ë©ë‹ˆë‹¤.

---

### 4. **íŒŒì¼ëª… ê·œì¹™ê³¼ ì²´í¬ì„¬ ì—ëŸ¬ í•´ê²°**

#### **íŒŒì¼ëª… ê·œì¹™**
-   **Prefix**: `V` (Versioned Migration) - ê°€ì¥ ë§ì´ ì‚¬ìš©.
-   **Version**: `1`, `1.1`, `2025122001` (ì–¸ë”ë°” `_`ë‚˜ ì  `.`ìœ¼ë¡œ êµ¬ë¶„).
-   **Separator**: `__` (ì–¸ë”ë°” 2ê°œ).
-   **Description**: íŒŒì¼ ë‚´ìš© ì„¤ëª… (íˆìŠ¤í† ë¦¬ í…Œì´ë¸”ì— ì €ì¥ë¨).
-   **Suffix**: `.sql`.
-   **ì˜ˆì‹œ**: `V20251220_01__Add_nickname_column.sql`

#### **Checksum Mismatch Error**
ì´ë¯¸ ë°°í¬ë˜ì–´ ì‹¤í–‰ëœ `V1__init.sql`ì˜ ê³µë°± í•˜ë‚˜ë¼ë„ ìˆ˜ì •í•˜ë©´, FlywayëŠ” "íŒŒì¼ì´ ë³€ì¡°ë˜ì—ˆë‹¤"ê³  íŒë‹¨í•˜ê³  ì—ëŸ¬ë¥¼ ë±‰ìœ¼ë©° ì„œë²„ ì‹œì‘ì„ ë§‰ìŠµë‹ˆë‹¤.

-   **ì›ì¹™**: í•œ ë²ˆ ë°°í¬ëœ(ì‹¤í–‰ëœ) SQL íŒŒì¼ì€ **ì ˆëŒ€ë¡œ ìˆ˜ì •í•˜ë©´ ì•ˆ ë©ë‹ˆë‹¤.**
-   **ìˆ˜ì • ë°©ë²•**: ìˆ˜ì •ì´ í•„ìš”í•˜ë©´ `V1`ì„ ê³ ì¹˜ëŠ” ê²Œ ì•„ë‹ˆë¼, `V2` íŒŒì¼ì„ ìƒˆë¡œ ë§Œë“¤ì–´ì„œ `ALTER TABLE` ë“±ì„ ìˆ˜í–‰í•´ì•¼ í•©ë‹ˆë‹¤.
-   **ë¡œì»¬ ê°œë°œ ì¤‘ ì‹¤ìˆ˜**: ë¡œì»¬ì—ì„œ ê°œë°œí•˜ë‹¤ê°€ ì‹¤ìˆ˜ë¡œ ìˆ˜ì •í•œ ê²½ìš°, `flyway_schema_history` í…Œì´ë¸”ì—ì„œ í•´ë‹¹ ë²„ì „ì˜ ë¡œìš°ë¥¼ ì‚­ì œ(`DELETE`)í•˜ê³  ë‹¤ì‹œ ì‹¤í–‰í•˜ê±°ë‚˜, `flyway repair` ëª…ë ¹ì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

---

## ğŸ’¡ ë°°ìš´ ì 

1.  **ì½”ë“œì™€ DBì˜ ì¼ì¹˜ì„±**: Flywayë¥¼ ì“°ë©´ ì†ŒìŠ¤ ì½”ë“œ(Git)ì˜ ë²„ì „ê³¼ DB ìŠ¤í‚¤ë§ˆì˜ ë²„ì „ì´ í•¨ê»˜ ê´€ë¦¬ë©ë‹ˆë‹¤. "ì´ ì»¤ë°‹ì—ëŠ” DB ë³€ê²½ì´ í¬í•¨ë˜ì–´ ìˆì–´"ë¼ëŠ” ê²ƒì„ ëª…í™•íˆ ì•Œ ìˆ˜ ìˆì–´ í˜‘ì—… ì‹œ ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ ë¹„ìš©ì´ ì¤„ì–´ë“­ë‹ˆë‹¤.
2.  **JPA `validate`ì˜ ì•ˆì •ê°**: ë¡œì»¬ì—ì„œëŠ” `create`ë‚˜ `update`ë¥¼ ì“°ë”ë¼ë„, ë°°í¬ í™˜ê²½ì—ì„œëŠ” `validate`ë¡œ ì„¤ì •í•´ë‘ë©´ ì—”í‹°í‹°ì™€ ì‹¤ì œ DB ìŠ¤í‚¤ë§ˆê°€ ë‹¤ë¥¼ ë•Œ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹œì‘ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ëŠ” ëŸ°íƒ€ì„ì— ë°œìƒí•  ìˆ˜ ìˆëŠ” ì¿¼ë¦¬ ì—ëŸ¬ë¥¼ ë¶€íŒ… ì‹œì ì— ë¯¸ë¦¬ ë§‰ì•„ì£¼ëŠ” ì•ˆì „ì¥ì¹˜ê°€ ë©ë‹ˆë‹¤.
3.  **CI/CD íŒŒì´í”„ë¼ì¸ì˜ ì™„ì„±**: ì  í‚¨ìŠ¤ë‚˜ Github Actionsì—ì„œ ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ê°€ ëŒ ë•Œ, Flywayê°€ ë¨¼ì € DBë¥¼ ìµœì‹  ìƒíƒœë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜í•˜ê³  -> ê·¸ ë‹¤ìŒ ìƒˆë¡œìš´ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ëœ¨ëŠ” ìˆœì„œë¥¼ ë³´ì¥í•¨ìœ¼ë¡œì¨ ë¬´ì¤‘ë‹¨ ë°°í¬ì˜ ê¸°ì´ˆë¥¼ ë‹¤ì§ˆ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

---

## ğŸ”— ì°¸ê³  ìë£Œ

-   [Flyway Documentation](https://documentation.red-gate.com/fd)
-   [Spring Boot Database Initialization](https://docs.spring.io/spring-boot/docs/current/reference/html/howto.html#howto.data-initialization.migration-tool.flyway)
-   [Evolutionary Database Design (Martin Fowler)](https://martinfowler.com/articles/evodb.html)