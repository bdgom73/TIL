---
title: "분산 시스템의 트레이드오프: CAP 이론과 최종 일관성"
date: 2025-09-28
categories: [Architecture, CS]
tags: [CAP Theorem, Distributed System, MSA, Consistency, Availability, Eventual Consistency, TIL]
excerpt: "분산 시스템 설계의 핵심 원칙인 CAP 이론의 세 가지 요소(일관성, 가용성, 분단 허용성)를 이해합니다. 현대 마이크로서비스 아키텍처(MSA)가 왜 강력한 일관성 대신 최종 일관성(Eventual Consistency)을 선택하는지에 대한 이유를 탐구합니다."
author_profile: true
---

# Today I Learned: 분산 시스템의 트레이드오프: CAP 이론과 최종 일관성

## 📚 오늘 학습한 내용

하나의 거대한 모놀리식 애플리케이션과 달리, 마이크로서비스 아키텍처(MSA)는 여러 개의 작은 서비스가 네트워크를 통해 통신하는 **분산 시스템**입니다. 분산 시스템을 설계할 때는 단일 시스템에서는 겪지 못했던 여러 가지 어려움에 직면하게 되는데, 이때 반드시 이해해야 할 기본 원칙이 바로 **CAP 이론**입니다. 오늘은 CAP 이론이 무엇이며, 왜 이 이론 때문에 많은 분산 시스템이 **최종 일관성(Eventual Consistency)**을 선택하는지 학습했습니다.

---

### 1. **CAP 이론이란 무엇인가?**

2000년에 Eric Brewer가 주장한 CAP 이론은 분산 데이터 저장소가 다음 세 가지 속성 중 **최대 두 가지만을 동시에 보장**할 수 있다는 원칙입니다.



-   **Consistency (일관성)**
    -   **의미**: 모든 노드가 동시에 같은 데이터를 보여주는 것을 보장합니다. 어떤 노드에 쓰기(Write) 작업이 성공했다면, 이후 어떤 노드에서 읽기(Read)를 하더라도 그 최신 값을 볼 수 있어야 합니다.
    -   **특징**: 데이터의 정합성이 매우 중요할 때 필요합니다. (e.g., 은행 계좌 잔액)

-   **Availability (가용성)**
    -   **의미**: 모든 요청에 대해 시스템은 항상 (에러가 아닌) 응답을 해야 함을 보장합니다. 일부 노드에 장애가 발생하더라도 시스템은 항상 동작해야 합니다.
    -   **특징**: 최신 데이터가 아닐 수는 있지만, 서비스가 '죽지 않고' 항상 응답하는 것이 중요할 때 필요합니다.

-   **Partition Tolerance (분단 허용성)**
    -   **의미**: 노드 간의 네트워크 통신이 끊어지거나(Network Partition), 메시지가 유실되더라도 시스템 전체가 동작을 멈추지 않아야 함을 보장합니다.
    -   **특징**: 여러 서버와 네트워크로 구성된 현대 분산 시스템에서 네트워크 단절은 언제든 발생할 수 있는 '장애'가 아닌 '일상적인 현상'으로 간주됩니다.

---

### 2. **선택의 기로: 왜 P는 포기할 수 없는가?**

CAP 이론은 세 가지 중 두 가지를 선택하는 문제처럼 보이지만, 현실의 분산 시스템에서는 선택지가 훨씬 좁혀집니다. **네트워크는 절대적으로 신뢰할 수 없기 때문**에 **분단 허용성(P)은 사실상 필수 조건**입니다.

네트워크 장애(Partition)가 발생했을 때, 시스템 설계자는 **일관성(C)**과 **가용성(A)** 사이에서 고통스러운 선택을 해야만 합니다.

-   **CP 시스템 (Consistency > Availability)**
    -   네트워크 단절이 발생하면, 데이터의 일관성을 깨뜨릴 위험이 있는 노드는 요청 처리를 중단하거나 에러를 반환합니다.
    -   **결과**: 데이터는 항상 일관성을 유지하지만, 일부 노드가 응답하지 않으므로 **가용성이 깨집니다.**
    -   **예시**: 분산 RDBMS, MongoDB의 일부 설정

-   **AP 시스템 (Availability > Consistency)**
    -   네트워크 단절이 발생하더라도, 각 노드는 독립적으로 계속해서 요청을 처리합니다.
    -   **결과**: 서비스는 항상 응답하여 **가용성을 유지**하지만, 네트워크가 복구되기 전까지 일부 노드는 오래된(Stale) 데이터를 보여줄 수 있으므로 **일관성이 깨집니다.**
    -   **예시**: 대부분의 NoSQL 데이터베이스 (e.g., Cassandra, DynamoDB), DNS

---

### 3. **최종 일관성(Eventual Consistency)의 선택**

많은 MSA와 대규모 웹 서비스는 CP가 아닌 AP 시스템을 지향하며, 이로 인해 발생하는 데이터 불일치를 **최종 일관성** 모델로 해결합니다.

-   **최종 일관성이란?**
    -   시스템에 더 이상 새로운 쓰기 작업이 없다고 가정할 때, **'결국에는(eventually)'** 모든 노드가 동일한 데이터를 갖게 되는 것을 보장하는 모델입니다.
    -   일시적으로 데이터가 다를 수 있지만, 일정 시간이 지나면 동기화되어 일관성을 회복합니다.

-   **왜 최종 일관성을 선택하는가?**
    -   **사용자 경험**: 은행 송금처럼 1원의 오차도 허용할 수 없는 금융 시스템이 아니라면, 대부분의 서비스에서는 강력한 일관성보다 높은 가용성이 더 중요합니다. 예를 들어, 소셜 미디어의 '좋아요' 수가 잠시 동안 정확하지 않더라도, '좋아요' 버튼이 아예 눌리지 않는 것(가용성 저하)보다 훨씬 나은 사용자 경험을 제공합니다.
    -   **성능과 확장성**: 모든 노드의 데이터가 항상 완벽하게 일치하도록 동기화하는 작업은 매우 큰 비용과 지연(Latency)을 유발합니다. 최종 일관성 모델은 이러한 동기화 부담을 줄여 시스템의 응답 속도를 높이고 수평적 확장을 용이하게 만듭니다.
    -   **느슨한 결합 (Loose Coupling)**: MSA에서 각 서비스는 독립적으로 동작해야 합니다. 최종 일관성은 다른 서비스의 상태와 관계없이 각 서비스가 가용성을 유지하며 동작할 수 있도록 하여 서비스 간의 결합도를 낮춥니다. CQRS, Saga 패턴 등도 이러한 최종 일관성 모델을 기반으로 동작합니다.

---

## 💡 배운 점

1.  **분산 시스템 설계는 트레이드오프의 연속이다**: CAP 이론은 완벽한 분산 시스템은 존재하지 않으며, 우리가 구축하려는 서비스의 비즈니스적 특성에 맞춰 일관성과 가용성 사이에서 어떤 것을 더 우선시할지 선택해야 한다는 것을 알려줍니다.
2.  **'P'는 현실이다**: 이론적으로는 C, A, P 세 가지 옵션이 있지만, 실제 MSA 환경을 구축할 때는 네트워크 장애를 반드시 일어나는 일로 가정하고 P를 기본으로 선택해야 한다는 점을 명확히 이해했습니다.
3.  **최종 일관성은 타협이 아닌 전략이다**: 최종 일관성은 단순히 일관성을 포기하는 것이 아니라, 더 높은 가용성과 성능을 얻기 위한 의도적인 아키텍처 전략입니다. 모든 비즈니스 로직에 강력한 일관성이 필요한 것은 아니며, 도메인의 특성을 파악하여 적절한 일관성 수준을 선택하는 것이 중요함을 깨달았습니다.

---

## 🔗 참고 자료

-   [A Plain English Introduction to CAP Theorem (Julian Shapiro)](https://www.julian.com/learn/cap-theorem/plain-english)
-   [CAP Twelve Years Later: How the "Rules" Have Changed (InfoQ)](https://www.infoq.com/articles/cap-twelve-years-later-how-the-rules-have-changed/)
-   [BASE: An Acid Alternative (ACM Queue)](https://queue.acm.org/detail.cfm?id=1394128)