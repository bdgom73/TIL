---
title: "Blue/Green 무중단 배포 전략의 이해"
date: 2025-10-17
categories: [DevOps, CI/CD]
tags: [Deployment Strategy, Blue/Green, High Availability, CI/CD, Canary, TIL]
excerpt: "애플리케이션 배포 시 서비스 중단을 없애고 안정성을 극대화하는 Blue/Green 배포 전략을 학습합니다. 이 전략의 동작 원리와 장단점, 그리고 데이터베이스 스키마 변경과 같은 실전 고려사항을 알아봅니다."
author_profile: true
---

# Today I Learned: Blue/Green 무중단 배포 전략의 이해

## 📚 오늘 학습한 내용

새로운 버전의 애플리케이션을 배포할 때, 가장 큰 고민은 '어떻게 서비스 중단(Downtime) 없이 안전하게 전환할 것인가'입니다. 기존 서버를 내리고 새 서버를 올리는 단순한 방식은 필연적으로 서비스 중단을 유발합니다. 오늘은 이러한 문제를 해결하고 안정적인 배포를 가능하게 하는 **Blue/Green 배포 전략**에 대해 깊이 있게 학습했습니다.

---

### 1. **Blue/Green 배포란 무엇인가? 🔵🟢**

**Blue/Green 배포**는 **동일한 구성의 두 개 환경**을 준비하여, 하나는 현재 운영 버전(Blue)으로 사용하고 다른 하나는 새로운 버전(Green)을 배포하는 전략입니다. 배포가 완료되고 검증이 끝나면, 라우터의 트래픽을 Blue에서 Green으로 한 번에 전환하여 사용자들이 새로운 버전을 사용하게 합니다.

-   **Blue Environment**: 현재 실제 운영 트래픽을 처리하고 있는 환경 (구 버전).
-   **Green Environment**: 새로 배포될 버전을 준비하고 테스트하는 대기 환경 (신 버전).

**비유**: 두 개의 똑같은 무대(A, B)를 가진 공연장과 같습니다. 관객들이 A 무대에서 공연을 보는 동안, B 무대에서는 다음 공연을 위한 모든 세팅을 완벽하게 마칩니다. 준비가 끝나면, 커튼을 내려 A 무대를 가리고 B 무대의 막을 올려 관객들이 즉시 다음 공연을 보게 하는 것과 같습니다.



---

### 2. **Blue/Green 배포의 단계별 흐름**

1.  **초기 상태**: 현재 **Blue** 환경이 로드 밸런서를 통해 모든 실시간 트래픽을 받고 있습니다. **Green** 환경은 대기 중이거나 이전 버전의 코드를 가지고 있습니다.

2.  **신규 버전 배포**: 새로운 버전의 애플리케이션을 **Green** 환경에 배포합니다. 이 과정은 실제 사용자 트래픽에 전혀 영향을 주지 않습니다.

3.  **Green 환경 검증**: Green 환경에만 접근할 수 있는 내부 URL이나 특정 헤더 값을 통해 QA팀이나 개발팀이 새로운 버전이 의도대로 잘 동작하는지 충분히 테스트합니다. (e.g., Smoke Test, 기능 테스트)

4.  **트래픽 전환**: 모든 검증이 완료되면, **로드 밸런서(라우터)**의 설정을 변경하여 모든 트래픽이 Blue가 아닌 **Green** 환경을 향하도록 한 번에 전환합니다. 이제 Green이 새로운 운영(Active) 환경이 됩니다.

5.  **전환 후**: Blue 환경은 이제 대기(Idle) 상태가 됩니다. 만약 Green 환경에서 예기치 않은 심각한 문제가 발생할 경우, **즉시 롤백**이 필요하면 라우터의 트래픽을 다시 Blue 환경으로 돌리기만 하면 됩니다. 문제가 없다면, Blue 환경은 다음 배포를 위한 대기 환경이 되거나 리소스를 절약하기 위해 종료될 수 있습니다.

---

### 3. **장점과 단점 (그리고 실전 고려사항)**

#### **장점 👍**

-   **제로 다운타임 (Zero Downtime)**: 트래픽 전환이 순간적으로 일어나므로 사용자는 서비스 중단을 전혀 느끼지 못합니다.
-   **즉각적인 롤백 (Instant Rollback)**: 신규 버전에 문제가 생겼을 때, 트래픽을 구 버전(Blue)으로 다시 돌리기만 하면 되므로 매우 빠르고 안정적인 롤백이 가능합니다.
-   **낮은 배포 리스크**: 실제 운영 트래픽에 영향을 주지 않는 격리된 환경에서 신규 버전을 충분히 테스트할 수 있습니다.

#### **단점 및 고려사항 👎**

-   **인프라 비용**: 동일한 환경을 2세트 유지해야 하므로, 서버와 인프라 비용이 거의 두 배로 듭니다.
-   **데이터베이스 스키마 관리**: Blue/Green 배포의 가장 큰 난관입니다. 만약 신규 버전이 DB 스키마 변경(e.g., 컬럼 추가/삭제)을 포함한다면, 구 버전(Blue)과 신 버전(Green)이 동시에 동일한 DB를 바라보는 짧은 시간 동안 호환성 문제가 발생할 수 있습니다.
    -   **해결책**: DB 스키마 변경은 애플리케이션 배포와 분리하여 처리해야 합니다. 하위 호환성을 유지하는 방향으로 점진적으로 스키마를 변경하는 전략이 필요합니다. (e.g., 1단계: 컬럼 추가 -> 2단계: 신규 버전 배포 -> 3단계: 구 버전 코드에서만 사용하던 컬럼 삭제)
-   **상태 관리(Stateful) 애플리케이션**: 사용자의 세션 정보 등을 서버 메모리에 저장하는 경우, 트래픽 전환 시 세션이 유실될 수 있습니다. 세션은 Redis와 같은 외부 스토리지에서 공유하여 관리해야 합니다.

---

## 💡 배운 점

1.  **배포는 단순한 파일 복사가 아니다**: 안정적인 배포는 치밀하게 계획된 '전략'의 영역임을 깨달았습니다. Blue/Green 배포는 인프라 자원을 활용하여 위험을 최소화하고 안정성을 극대화하는 매우 효과적인 엔지니어링 실천 방법입니다.
2.  **데이터베이스는 언제나 발목을 잡는다**: 아무리 배포 전략이 훌륭해도, 공유 자원인 데이터베이스의 상태를 어떻게 관리할 것인지에 대한 고민이 없다면 무용지물이 될 수 있습니다. 애플리케이션의 무중단 배포를 위해서는 데이터베이스 스키마의 하위 호환성을 유지하는 능력이 필수적입니다.
3.  **상황에 맞는 전략 선택**: Blue/Green 전략은 안정적이지만 비용이 많이 듭니다. 트래픽의 일부만 새로운 버전으로 보내 점진적으로 테스트하는 **카나리(Canary) 배포** 등 다른 전략들도 존재합니다. 서비스의 특성과 중요도, 비용 등을 종합적으로 고려하여 최적의 배포 전략을 선택하는 안목이 필요함을 느꼈습니다.

---

## 🔗 참고 자료

-   [BlueGreenDeployment (Martin Fowler)](https://martinfowler.com/bliki/BlueGreenDeployment.html)
-   [What is blue/green deployment? (AWS)](https://aws.amazon.com/what-is/blue-green-deployment/)
-   [Deployment Strategies (Argo CD Documentation)](https://argo-cd.readthedocs.io/en/stable/operator-manual/applicationset/Controlling-Rollout/)