---
title: "스레드 안전성과 불변성의 상관관계"
date: 2025-09-05
categories: [CS]
tags: [스레드, 불변성, 동시성, JAVA]
excerpt: "불변성은 동시성을 안전하게 처리하기 위한 강력한 개념이다. 오늘은 불변성과 스레드 안전성이 어떻게 연관되어 있는지, 그리고 실무에서 어떻게 활용되는지 살펴보았다."
author_profile: true
---

# Today I Learned: 스레드 안전성과 불변성의 상관관계

## ## 스레드 안전성과 그 중요성 🧵

**스레드 안전성(Thread Safety)**이란, 프로그램이 여러 스레드에서 동시에 실행될 때도 올바르게 동작할 수 있는 성질을 의미한다. 이는 현대의 멀티코어 환경에서 필수적인 개념이다. 잘못된 스레드 안전성 처리로 인해 발생하는 문제는 다음과 같다:

- **데이터 레이스(Data Race)**: 여러 스레드가 공유 데이터에 동시 접근하여 예상치 못한 결과를 초래하는 문제.
- **상태 불일치(State Inconsistency)**: 스레드 간 데이터가 적절히 동기화되지 않아 데이터 상태가 불규칙적으로 변경되는 문제.

### 불변성(Immutability)의 역할  
스레드 안전성을 보장하기 위해 사용하는 많은 기법(예: 락, synchronized 블록)은 성능 문제를 야기할 수 있다. 불변성은 이러한 단점을 보완하는 중요한 대안이다.

---

## ## 불변성과 스레드 안전성의 연관성 🔗

**불변성(immutability)**은 객체 생성 후 해당 객체의 상태(state)를 변경할 수 없도록 설계된 성질이다. 불변 객체는 다음과 같은 방식으로 스레드 안전성 문제를 해결한다:

### 1. **공유 데이터의 안전한 접근**  
- 불변 객체는 동시에 여러 스레드가 접근해도 **데이터 조작이 불가능**하므로 Data Race의 위험이 없다.
- 읽기 전용 데이터만 가지기 때문에 별도의 락(lock) 없이 안전하다.

### 2. **복사 생성(Copy-on-Write) 모델과의 상호보완**  
- 상태가 변경된 데이터가 필요하다면 새로운 불변 객체를 생성해 동작한다.
- 이는 기존 데이터를 상하게 하지 않으므로 멀티 스레드 환경에서도 안정성을 유지한다.

### 3. **함수형 프로그래밍 패러다임과의 연결**  
- 불변 객체를 이용해 **순수 함수(Pure Function)**를 작성할 수 있다.
- 동일한 입력값에 대해 항상 같은 결과를 보장하여 디버깅 및 테스트가 용이하다.

---

## ## 실무 사례를 통해 보는 불변성과 스레드 안전성 🛠️

#### **Java String 클래스**  
Java의 `String` 클래스는 대표적인 불변 객체다. 멀티 스레드 환경에서 많은 스레드가 동일한 `String` 객체를 읽을 때도 데이터 보호를 위한 추가 비용 없이 안전하게 작동한다.

#### **Collections.unmodifiableXXX() 사용**  
Java에서 mutable한 `List`나 `Map`을 불변화하고 싶다면 `Collections.unmodifiableList`와 같은 메서드를 사용할 수 있다. 이렇게 하면 공유 데이터를 읽기 전용으로 강제할 수 있다.

#### **Java의 LocalDateTime**  
Java 8의 날짜 및 시간 API (`java.time.LocalDateTime` 등)는 불변으로 설계되어 정확한 동작과 스레드 안전성을 보장한다.

---

## ## 불변성이 완벽한 해결책일까? 🤔

불변성이 스레드 안전성 문제의 완벽한 해결책은 아니며, 다음과 같은 단점이 존재한다:

1. **성능 문제**: 불변 객체를 새로 생성해야 하는 경우가 많아, 메모리 사용량이 증가할 수 있다.
2. **복잡한 데이터 구조**: 불변 객체로 **구조가 복잡한 데이터**를 표현하려면 추가적인 객체 생성 및 관리가 필요하다.

### 보완 방법:
- 불변 객체를 복사할 필요가 없도록 **참조 공유(Read-only Reference)** 기법을 활용.
- 변경 가능한 데이터가 필요할 경우에는 `Atomic` 클래스나 `synchronized`와 같은 다른 동시성 제어 기법을 적절히 조합.

---

## ## 결론 ✨

불변성은 스레드 안전성을 보장하는 강력한 도구다. 데이터를 명시적으로 불변화함으로써 동시성 문제를 단순화하고, 디버깅과 유지보수를 크게 개선할 수 있다. 하지만 성능이나 구조적인 복잡성 문제를 고려해 실무에서는 적절히 다른 기법과 병행하여 사용하는 것이 중요하다.

**"스레드 안전성을 유지하기 위해 불변성을 어떻게 활용할 것인가?"**에 대해 깊이 고민하는 것은 안전하고 확장 가능한 시스템을 만드는 초석이 될 것이다.