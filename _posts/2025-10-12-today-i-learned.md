---
title: "JWT ì¸ì¦ì˜ ì™„ì„±: Refresh Tokenì„ í™œìš©í•œ ë˜‘ë˜‘í•œ ì„¸ì…˜ ê´€ë¦¬"
date: 2025-10-12
categories: [Spring, Security]
tags: [Spring Security, JWT, Refresh Token, Authentication, Authorization, TIL]
excerpt: "Stateless JWT ì¸ì¦ ë°©ì‹ì—ì„œ Access Tokenë§Œ ì‚¬ìš©í•  ë•Œ ë°œìƒí•˜ëŠ” ë³´ì•ˆê³¼ í¸ì˜ì„±ì˜ íŠ¸ë ˆì´ë“œì˜¤í”„ ë¬¸ì œë¥¼ ë¶„ì„í•©ë‹ˆë‹¤. Refresh Tokenì„ ë„ì…í•˜ì—¬ ë‘ ë§ˆë¦¬ í† ë¼ë¥¼ ëª¨ë‘ ì¡ëŠ” ì„¸ì…˜ ê´€ë¦¬ ì „ëµê³¼ ê·¸ ì•ˆì „í•œ êµ¬í˜„ ë°©ë²•ì— ëŒ€í•´ ì‹¬ì¸µì ìœ¼ë¡œ í•™ìŠµí•©ë‹ˆë‹¤."
author_profile: true
---

# Today I Learned: JWT ì¸ì¦ì˜ ì™„ì„±: Refresh Tokenì„ í™œìš©í•œ ë˜‘ë˜‘í•œ ì„¸ì…˜ ê´€ë¦¬

## ğŸ“š ì˜¤ëŠ˜ í•™ìŠµí•œ ë‚´ìš©

ì–´ì œì— ì´ì–´ JWT ì¸ì¦ ì‹œìŠ¤í…œì— ëŒ€í•´ ë” ê¹Šì´ íŒŒê³ ë“¤ì—ˆìŠµë‹ˆë‹¤. íŠ¹íˆ Access Tokenë§Œìœ¼ë¡œëŠ” í•´ê²°í•˜ê¸° ì–´ë ¤ìš´ **'ë³´ì•ˆ'ê³¼ 'ì‚¬ìš©ì í¸ì˜ì„±'ì´ë¼ëŠ” ë‘ ê°€ì§€ ìƒì¶©í•˜ëŠ” ëª©í‘œ**ë¥¼ ì–´ë–»ê²Œ ì¡°í™”ì‹œí‚¬ ìˆ˜ ìˆëŠ”ì§€ì— ì´ˆì ì„ ë§ì¶”ì—ˆìŠµë‹ˆë‹¤. ê·¸ í•´ë‹µì€ ë°”ë¡œ **Refresh Token**ì„ ë„ì…í•˜ì—¬ ë‘ í† í°ì˜ ì—­í• ì„ ëª…í™•íˆ ë¶„ë¦¬í•˜ëŠ” ê²ƒì— ìˆì—ˆìŠµë‹ˆë‹¤.

---

### 1. **ë¬¸ì œ ì •ì˜: ë†€ì´ê³µì›ì˜ ììœ ì´ìš©ê¶Œ (Access Token)**

JWTì˜ **Access Token**ì€ ë†€ì´ê³µì›ì˜ 'ììœ ì´ìš©ê¶Œ'ê³¼ ê°™ìŠµë‹ˆë‹¤. ì´ í‹°ì¼“ë§Œ ìˆìœ¼ë©´ ìœ íš¨ ì‹œê°„ ë™ì•ˆ ëª¨ë“  ë†€ì´ê¸°êµ¬ë¥¼ ë§ˆìŒê» íƒˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì„œë²„ëŠ” ë§¤ë²ˆ í‹°ì¼“ì˜ ìœ íš¨ ê¸°ê°„ë§Œ í™•ì¸í•  ë¿, ì´ í‹°ì¼“ì„ ëˆ„ê°€ ê°€ì§€ê³  ìˆëŠ”ì§€ ì¼ì¼ì´ ì¶”ì í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤ (Stateless).

-   **í¸ë¦¬í•¨**: ì„œë²„ê°€ ì‚¬ìš©ìì˜ ìƒíƒœë¥¼ ê¸°ì–µí•  í•„ìš”ê°€ ì—†ì–´ í™•ì¥ì„±ì´ ë›°ì–´ë‚©ë‹ˆë‹¤.
-   **ë”œë ˆë§ˆ**:
    -   ë§Œì•½ **ìœ íš¨ ê¸°ê°„ì´ 8ì‹œê°„**ì¸ ììœ ì´ìš©ê¶Œì„ ìƒì–´ë²„ë¦°ë‹¤ë©´? ì£¼ìš´ ì‚¬ëŒì€ 8ì‹œê°„ ë™ì•ˆ ê³µì§œë¡œ ë†€ì´ê¸°êµ¬ë¥¼ íƒˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. (í† í° íƒˆì·¨ ì‹œ ë³´ì•ˆ ìœ„í˜‘)
    -   ë§Œì•½ **ìœ íš¨ ê¸°ê°„ì´ 10ë¶„**ì´ë¼ë©´? 10ë¶„ë§ˆë‹¤ ë§¤í‘œì†Œì— ê°€ì„œ ì‹ ë¶„ì¦ì„ ë³´ì—¬ì£¼ê³  í‹°ì¼“ì„ ì¬ë°œê¸‰ë°›ì•„ì•¼ í•©ë‹ˆë‹¤. (ì¦ì€ ì¬ë¡œê·¸ì¸ìœ¼ë¡œ ì¸í•œ ìµœì•…ì˜ ì‚¬ìš©ì ê²½í—˜)

ì´ì²˜ëŸ¼ Access Tokenì˜ ìœ íš¨ ê¸°ê°„ ì„¤ì •ì€ ë³´ì•ˆê³¼ í¸ì˜ì„± ì‚¬ì´ì˜ ê³ í†µìŠ¤ëŸ¬ìš´ íŠ¸ë ˆì´ë“œì˜¤í”„ë¥¼ ì•¼ê¸°í•©ë‹ˆë‹¤.

---

### 2. **í•´ê²°ì±…: ë³´ê´€ì†Œ ì—´ì‡  (Refresh Token)ì˜ ë„ì…**

ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ 'ììœ ì´ìš©ê¶Œ'ê³¼ ë³„ê°œë¡œ **'ê°œì¸ ë³´ê´€ì†Œ ì—´ì‡ (Refresh Token)'**ë¥¼ ì¶”ê°€ë¡œ ë°œê¸‰í•˜ëŠ” ì „ëµì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

-   **ììœ ì´ìš©ê¶Œ (Access Token)**
    -   **ì—­í• **: ë†€ì´ê¸°êµ¬ íƒ‘ìŠ¹ (API ë¦¬ì†ŒìŠ¤ ì ‘ê·¼)
    -   **ìœ íš¨ ê¸°ê°„**: **15ë¶„** (ë§¤ìš° ì§§ê²Œ ì„¤ì •í•˜ì—¬ íƒˆì·¨ ìœ„í—˜ ìµœì†Œí™”)

-   **ê°œì¸ ë³´ê´€ì†Œ ì—´ì‡  (Refresh Token)**
    -   **ì—­í• **: ììœ ì´ìš©ê¶Œì´ ë§Œë£Œëì„ ë•Œ, ë§¤í‘œì†Œì— ê°€ì„œ **ìƒˆ ììœ ì´ìš©ê¶Œì„ ë°œê¸‰ë°›ëŠ” ìš©ë„**
    -   **ìœ íš¨ ê¸°ê°„**: **7ì¼** (ê¸¸ê²Œ ì„¤ì •í•˜ì—¬ ì‚¬ìš©ì í¸ì˜ì„± ë³´ì¥)
    -   **íŠ¹ì§•**: ì´ ì—´ì‡ ë§Œìœ¼ë¡œëŠ” ë†€ì´ê¸°êµ¬ë¥¼ íƒˆ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

#### **ê°œì„ ëœ ì¸ì¦ íë¦„**

1.  **ì…ì¥**: ì‚¬ìš©ìê°€ ë¡œê·¸ì¸í•˜ë©´, ì„œë²„ëŠ” ì§§ì€ ìˆ˜ëª…ì˜ **Access Token**ê³¼ ê¸´ ìˆ˜ëª…ì˜ **Refresh Token**ì„ í•¨ê»˜ ë°œê¸‰í•©ë‹ˆë‹¤.
2.  **ë†€ì´ê¸°êµ¬ íƒ‘ìŠ¹**: ì‚¬ìš©ìëŠ” 15ë¶„ê°„ Access Tokenìœ¼ë¡œ ììœ ë¡­ê²Œ APIë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
3.  **ì´ìš©ê¶Œ ë§Œë£Œ**: 15ë¶„ì´ ì§€ë‚˜ Access Tokenì´ ë§Œë£Œë˜ë©´, API ì„œë²„ëŠ” `401 Unauthorized` ì—ëŸ¬ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
4.  **ì¬ë°œê¸‰ ìš”ì²­**: í´ë¼ì´ì–¸íŠ¸ëŠ” ì´ ì—ëŸ¬ë¥¼ ê°ì§€í•˜ê³ , ë³´ê´€í•˜ê³  ìˆë˜ **Refresh Token(ë³´ê´€ì†Œ ì—´ì‡ )**ì„ ì¬ë°œê¸‰ ì „ìš© ì°½êµ¬(`/api/token/refresh`)ì— ì œì‹œí•©ë‹ˆë‹¤.
5.  **ì‹ ì› í™•ì¸ ë° ì¬ë°œê¸‰**: ì„œë²„ëŠ” **"ì´ ì—´ì‡ ê°€ ìš°ë¦¬ê°€ ë°œê¸‰í•œ ê²ƒì´ ë§ê³ , ì—¬ì „íˆ ìœ íš¨í•œê°€?"**ë¥¼ í™•ì¸í•©ë‹ˆë‹¤. ì´ ê³¼ì •ì´ ì„±ê³µí•˜ë©´, ìƒˆë¡œìš´ 15ë¶„ì§œë¦¬ **Access Token**ì„ ë°œê¸‰í•´ì¤ë‹ˆë‹¤.
6.  **ë‹¤ì‹œ íƒ‘ìŠ¹**: í´ë¼ì´ì–¸íŠ¸ëŠ” ìƒˆë¡œ ë°›ì€ Access Tokenìœ¼ë¡œ ì•„ê¹Œ ì‹¤íŒ¨í–ˆë˜ APIë¥¼ ë‹¤ì‹œ í˜¸ì¶œí•©ë‹ˆë‹¤. ì‚¬ìš©ìëŠ” ì¬ë¡œê·¸ì¸ ì—†ì´ ì„œë¹„ìŠ¤ë¥¼ ê³„ì† ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.



---

### 3. **ê°€ì¥ ì¤‘ìš”í•œ ê²ƒ: Refresh Tokenì€ ë°˜ë“œì‹œ ì„œë²„ê°€ ê¸°ì–µí•´ì•¼ í•œë‹¤**

Refresh Token ì „ëµì˜ í•µì‹¬ ë³´ì•ˆ ìš”ê±´ì€ **ì„œë²„ê°€ ë°œê¸‰í•œ ëª¨ë“  Refresh Tokenì„ ì €ì¥í•˜ê³  ì¶”ì **í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

-   **ì™œ?**: ë§Œì•½ Refresh Tokenì´ íƒˆì·¨ë‹¹í–ˆì„ ë•Œ, ì„œë²„ê°€ ê·¸ í† í°ì„ ê°•ì œë¡œ ë¬´íš¨í™”í•  ìˆ˜ ìˆì–´ì•¼ í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ì„œë²„ì— ì €ì¥ëœ Refresh Token ëª©ë¡ì—ì„œ í•´ë‹¹ í† í°ì„ ì‚­ì œí•˜ë©´, ê³µê²©ìëŠ” ë” ì´ìƒ ìƒˆë¡œìš´ Access Tokenì„ ë°œê¸‰ë°›ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
-   **êµ¬í˜„**:
    -   ì‚¬ìš©ì ë¡œê·¸ì¸ ì‹œ Refresh Tokenì„ ìƒì„±í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ì— ë³´ë‚´ëŠ” ë™ì‹œì—, í•´ë‹¹ í† í°ì„ **DBë‚˜ Redis**ì— `(ì‚¬ìš©ì ID, Refresh Token)` í˜•íƒœë¡œ ì €ì¥í•©ë‹ˆë‹¤.
    -   í† í° ì¬ë°œê¸‰ ìš”ì²­ì´ ì˜¤ë©´, í´ë¼ì´ì–¸íŠ¸ê°€ ë³´ë‚¸ Refresh Tokenì´ ìš°ë¦¬ DBì— ì €ì¥ëœ ê°’ê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ ë°˜ë“œì‹œ í™•ì¸í•©ë‹ˆë‹¤.
    -   ì‚¬ìš©ìê°€ ë¡œê·¸ì•„ì›ƒí•˜ë©´, DBì—ì„œ í•´ë‹¹ Refresh Tokenì„ ì‚­ì œí•˜ì—¬ ì„¸ì…˜ì„ ì¦‰ì‹œ ì¢…ë£Œì‹œí‚µë‹ˆë‹¤.

```java
// ì¬ë°œê¸‰ ë¡œì§ì˜ í•µì‹¬ (ê°œë… ì½”ë“œ)
public TokenInfo reissue(String refreshToken) {
    // 1. í† í° ìì²´ì˜ ìœ íš¨ì„± ê²€ì¦ (ë§Œë£Œì¼, ì„œëª… ë“±)
    validateToken(refreshToken);

    // 2. ì„œë²„ ì €ì¥ì†Œì— í•´ë‹¹ í† í°ì´ ì¡´ì¬í•˜ëŠ”ì§€, ìœ íš¨í•œì§€ í™•ì¸
    RefreshToken storedToken = refreshTokenRepository.findByToken(refreshToken)
        .orElseThrow(() -> new SecurityException("Invalid or expired refresh token."));

    // 3. ê²€ì¦ ì™„ë£Œ. ìƒˆë¡œìš´ í† í° ìŒ ë°œê¸‰
    String userId = storedToken.getUserId();
    String newAccessToken = createAccessToken(userId);
    String newRefreshToken = createRefreshToken(); // RTR(Refresh Token Rotation) ì ìš© ì‹œ

    // 4. ìƒˆë¡œìš´ Refresh Tokenìœ¼ë¡œ ì €ì¥ì†Œ ì—…ë°ì´íŠ¸
    storedToken.updateToken(newRefreshToken);
    refreshTokenRepository.save(storedToken);

    return new TokenInfo(newAccessToken, newRefreshToken);
}
```

---

## ğŸ’¡ ë°°ìš´ ì 

1.  **ì—­í• ì˜ ë¶„ë¦¬**: Access Tokenì€ 'ì¸ì¦'ì„ ìœ„í•œ ì†Œëª¨ì„± í‹°ì¼“, Refresh Tokenì€ 'ì¸ì¦ ê°±ì‹ 'ì„ ìœ„í•œ ì¥ê¸°ì ì¸ ì‹ ë¶„ ì¦ëª…ì„œë¡œ ì—­í• ì„ ëª…í™•íˆ ë¶„ë¦¬í•˜ëŠ” ê²ƒì´ í•µì‹¬ì„ì„ ì´í•´í–ˆìŠµë‹ˆë‹¤.
2.  **Statelessì˜ í•¨ì •**: JWTëŠ” Stateless í†µì‹ ì„ ê°€ëŠ¥í•˜ê²Œ í•˜ì§€ë§Œ, ì™„ë²½í•œ ë³´ì•ˆì„ ìœ„í•´ì„œëŠ” Refresh Tokenì˜ ìœ íš¨ì„±ì„ ê²€ì¦í•˜ëŠ” 'Stateful'í•œ ë©”ì»¤ë‹ˆì¦˜ì´ ì„œë²„ ì¸¡ì— ë°˜ë“œì‹œ í•„ìš”í•©ë‹ˆë‹¤. 'ëª¨ë“  ê²ƒì„ Statelessë¡œ í•´ì•¼ í•œë‹¤'ëŠ” ê°•ë°•ì—ì„œ ë²—ì–´ë‚˜, ìƒí™©ì— ë§ê²Œ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.
3.  **ì‚¬ìš©ì ê²½í—˜ê³¼ ë³´ì•ˆì€ í•¨ê»˜ ê°„ë‹¤**: Refresh Token ì „ëµì€ ë³´ì•ˆì„ ê°•í™”í•˜ë©´ì„œë„(Access Token íƒˆì·¨ ì‹œ í”¼í•´ ìµœì†Œí™”) ì‚¬ìš©ìì—ê²ŒëŠ” ì¬ë¡œê·¸ì¸ì˜ ë¶ˆí¸í•¨ì„ ì£¼ì§€ ì•ŠëŠ”, ë‘ ë§ˆë¦¬ í† ë¼ë¥¼ ëª¨ë‘ ì¡ëŠ” ë§¤ìš° ì‹¤ìš©ì ì´ê³  ì„±ìˆ™í•œ í•´ê²°ì±…ì„ì„ ê¹¨ë‹¬ì•˜ìŠµë‹ˆë‹¤.

---

## ğŸ”— ì°¸ê³  ìë£Œ

-   [JWT.io - Introduction to JSON Web Tokens](https://jwt.io/introduction)
-   [Stop using JWT for sessions (joepie91's blog)](https://joepie91.medium.com/stop-using-jwt-for-sessions-5969242a4933)
-   [Refreshing JWTs with a Refresh Token (Baeldung)](https://www.baeldung.com/spring-security-oauth-refresh-token)